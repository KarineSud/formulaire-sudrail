<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - SUD Rail</title>
    <link rel="stylesheet" href="admin.css">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- EmailJS v4 (derni√®re version support√©e) -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <!-- Page de connexion -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="logo-container">
                <div class="logo-text">
                    <div class="logo-main">SUD</div>
                    <div class="logo-sub">Rail</div>
                    <div class="logo-region">Administration</div>
                </div>
            </div>
            
            <h2>Acc√®s Administration</h2>
            <p class="login-subtitle">Gestion des inscriptions au forum</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required placeholder="karinesudrail@gmail.com">
                    <div class="error-message" id="emailError"></div>
                </div>
                
                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <input type="password" id="password" name="password" required>
                    <div class="error-message" id="passwordError"></div>
                </div>
                
                <button type="submit" class="btn-login">
                    <span class="btn-text">Se connecter</span>
                    <span class="loader" id="loginLoader"></span>
                </button>
            </form>
            
            <div class="login-footer">
                <a href="index.html">‚Üê Retour au formulaire</a>
            </div>
        </div>
    </div>

    <!-- Dashboard principal -->
    <div id="dashboardPage" class="dashboard-container" style="display: none;">
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo-text small">
                    <div class="logo-main">SUD</div>
                    <div class="logo-sub">Rail</div>
                    <div class="logo-region">Dashboard</div>
                </div>
                
                <div class="header-actions">
                    <span class="admin-name">Bonjour, Karine</span>
                    <button id="logoutBtn" class="btn-logout">D√©connexion</button>
                </div>
            </div>
        </header>

        <main class="dashboard-main">
            <!-- Statistiques -->
            <section class="stats-section">
                <h2>üìä R√©sum√© des inscriptions</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalInscriptions">0</div>
                        <div class="stat-label">Total inscriptions</div>
                    </div>
                    <div class="stat-card status-received">
                        <div class="stat-number" id="statusReceived">0</div>
                        <div class="stat-label">üü° Demandes re√ßues</div>
                    </div>
                    <div class="stat-card status-requested">
                        <div class="stat-number" id="statusRequested">0</div>
                        <div class="stat-label">üîµ D√©gagement demand√©</div>
                    </div>
                    <div class="stat-card status-accepted">
                        <div class="stat-number" id="statusAccepted">0</div>
                        <div class="stat-label">‚úÖ Demandes accept√©es</div>
                    </div>
                    <div class="stat-card status-refused">
                        <div class="stat-number" id="statusRefused">0</div>
                        <div class="stat-label">‚ùå Demandes refus√©es</div>
                    </div>
                    <div class="stat-card status-transmitted">
                        <div class="stat-number" id="statusTransmitted">0</div>
                        <div class="stat-label">üìß R√©ponses transmises</div>
                    </div>
                </div>
            </section>

            <!-- Configuration email -->
            <section class="email-config-section">
                <h3>üìß Configuration des notifications</h3>
                <div class="email-config">
                    <div class="form-group inline">
                        <label for="notificationEmail">Email de notification :</label>
                        <input type="email" id="notificationEmail" value="karinesudrail@gmail.com">
                        <button id="updateEmailBtn" class="btn-secondary">Mettre √† jour</button>
                        <button id="testEmailBtn" class="btn-secondary">Test Email</button>
                    </div>
                    <div class="email-status" id="emailStatus"></div>
                </div>
            </section>

            <!-- Filtres et recherche -->
            <section class="filters-section">
                <h3>üîç Gestion des inscriptions</h3>
                <div class="filters-bar">
                    <div class="filter-group">
                        <label for="statusFilter">Statut :</label>
                        <select id="statusFilter">
                            <option value="">Tous les statuts</option>
                            <option value="Demande re√ßue">üü° Demandes re√ßues</option>
                            <option value="Demande de d√©gagement demand√©e">üîµ D√©gagement demand√©</option>
                            <option value="Demande accept√©e">‚úÖ Demandes accept√©es</option>
                            <option value="Demande refus√©e">‚ùå Demandes refus√©es</option>
                            <option value="R√©ponse transmise √† l'agent">üìß R√©ponses transmises</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="sortBy">Trier par :</label>
                        <select id="sortBy">
                            <option value="date_desc">Date (r√©cent)</option>
                            <option value="date_asc">Date (ancien)</option>
                            <option value="nom_asc">Nom A‚ÜíZ</option>
                            <option value="nom_desc">Nom Z‚ÜíA</option>
                            <option value="statut">Statut</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="searchText">Recherche :</label>
                        <input type="text" id="searchText" placeholder="Nom, pr√©nom, CP, UO...">
                    </div>
                    
                    <button id="refreshBtn" class="btn-secondary">üîÑ Actualiser</button>
                </div>
            </section>

            <!-- Tableau des inscriptions -->
            <section class="table-section">
                <div class="table-container">
                    <table class="inscriptions-table" id="inscriptionsTable">
                        <thead>
                            <tr>
                                <th data-sort="nom">Nom</th>
                                <th data-sort="prenom">Pr√©nom</th>
                                <th data-sort="numero_cp">CP</th>
                                <th data-sort="lieu_affectation_uo">Lieu d'affectation</th>
                                <th data-sort="statut">√âtat</th>
                                <th data-sort="date_inscription">Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inscriptionsTableBody">
                            <!-- Les donn√©es seront charg√©es par JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div id="emptyState" class="empty-state" style="display: none;">
                    <p>üì≠ Aucune inscription trouv√©e</p>
                    <small>Les nouvelles inscriptions appara√Ætront ici automatiquement</small>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de modification du statut -->
    <div id="statusModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Modifier le statut</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="participant-info">
                    <h4 id="modalParticipantName">Nom Pr√©nom</h4>
                    <p><strong>CP :</strong> <span id="modalParticipantCP">123456</span></p>
                    <p><strong>UO :</strong> <span id="modalParticipantUO">Lieu</span></p>
                </div>
                
                <div class="form-group">
                    <label for="modalStatus">Nouveau statut :</label>
                    <select id="modalStatus">
                        <option value="Demande re√ßue">üü° Demande re√ßue</option>
                        <option value="Demande de d√©gagement demand√©e">üîµ Demande de d√©gagement demand√©e</option>
                        <option value="Demande accept√©e">‚úÖ Demande accept√©e</option>
                        <option value="Demande refus√©e">‚ùå Demande refus√©e</option>
                        <option value="R√©ponse transmise √† l'agent">üìß R√©ponse transmise √† l'agent</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="modalComment">Commentaire (optionnel) :</label>
                    <textarea id="modalComment" rows="3" placeholder="Notes sur ce changement de statut..."></textarea>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="modalCancel" class="btn-secondary">Annuler</button>
                <button id="modalSave" class="btn-primary">Sauvegarder</button>
            </div>
        </div>
    </div>

    <script src="config/supabase.js"></script>
    <script src="config/constants.js"></script>
    <script src="admin.js"></script>
    <script>
        // Configuration EmailJS v4 avec votre vraie Public Key
        (function() {
            emailjs.init("4LkUHc9SbFqzXSZ-U"); // ‚úÖ Votre vraie Public Key !
        })();
    </script>
</body>
</html>